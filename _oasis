OASISFormat: 0.4
Name: imap
Version: 0.9.0
Synopsis: IMAP client library for Lwt
Authors: Nicolas Ojeda Bar
License: MIT
Plugins: DevFiles (0.4), META (0.4)
BuildTools: ocamlbuild

Flag all
  Description: build and install everything
  Default$: true

Flag gsasl
  Description: GNU SASL support
  Default$: flag(all)

Flag lwt
  Description: Lwt support
  Default$: flag(all)

Flag unix
  Description: Unix support
  Default$: flag(all)

Flag async
  Description: Async support
  Default$: flag(all)

Library "imap"
  Path: lib/core
  FindlibName: imap
  Modules: Imap_mime, Imap_types, Imap_set,
           Imap, Imap_uint, Imap_auth, Imap_io
  InternalModules: Imap_sender, Imap_parser, Imap_uint_raw, Imap_response, Imap_utils
  BuildDepends: uint, str, cryptokit, ucorelib, sexplib, sexplib.syntax

Library "imap-unix"
  Build$: flag(unix)
  Install$: flag(unix)
  Path: lib/unix
  FindlibName: unix
  FindlibParent: imap
  Modules: Imap_unix
  # InternalModules: Imap_gen_io
  BuildDepends: imap, unix, ssl, cryptokit

Library "imap-lwt"
  Build$: flag(lwt)
  Install$: flag(lwt)
  Path: lib/lwt
  FindlibName: lwt
  FindlibParent: imap
  Modules: Imap_lwt
  BuildDepends: imap, lwt, lwt.ssl, lwt.unix

Library "imap-gsasl"
  Build$: flag(gsasl)
  Install$: flag(gsasl)
  Path: lib/gsasl
  FindlibName: gsasl
  FindlibParent: imap
  # XXX
  CCLib: -L/usr/local/Cellar/libffi/3.0.13/lib
  Modules: Imap_gsasl
  BuildDepends: imap, gsasl

Library "imap-async"
  Build$: flag(async)
  Install$: flag(async)
  Path: lib/async
  FindlibName: async
  FindlibParent: imap
  CCLib: -lssl -lcrypto -v
  Modules: Imap_async
  BuildDepends: threads, imap, async, async_ssl
  
Document imap
  Title: Imap docs
  Type: ocamlbuild (0.4)
  BuildTools+: ocamldoc
  Install: true
  XOCamlbuildPath: lib
  XOCamlbuildLibraries: imap

Executable test_parser
  Path: lib_test
  MainIs: test_parser.ml
  Build$: flag(tests)
  Custom: true
  CompiledObject: best
  Install: false
  BuildDepends: imap, oUnit (>= 2.0.0)

Executable test_set
  Path: lib_test
  MainIs: test_set.ml
  Build$: flag(tests)
  Custom: true
  CompiledObject: best
  Install: false
  BuildDepends: imap, oUnit (>= 2.0.0)

Executable test_mutf7
  Path: lib_test
  MainIs: test_mutf7.ml
  Build$: flag(tests)
  Custom: true
  CompiledObject: best
  Install: false
  BuildDepends: imap, oUnit (>= 2.0.0)

Executable test_live
  Path: lib_test
  MainIs: test_live.ml
  Build$: flag(tests)
  Custom: true
  CompiledObject: best
  Install: false
  BuildDepends: imap.lwt, oUnit (>= 2.0.0)

Executable test_io
  Path: lib_test
  MainIs: test_io.ml
  Build$: false # flag(tests)
  Custom: true
  CompiledObject: best
  Install: false
  BuildDepends: imap.unix, oUnit (>= 2.0.0)

Executable test_condstore
  Path: lib_test
  MainIs: test_condstore.ml
  Build$: flag(tests)
  Custom: true
  CompiledObject: best
  Install: false
  BuildDepends: imap.lwt, oUnit (>= 2.0.0)

Executable test_id
  Path: lib_test
  MainIs: test_id.ml
  Build$: flag(tests)
  Custom: true
  CompiledObject: best
  Install: false
  BuildDepends: imap.lwt, oUnit (>= 2.0.0)

Executable test_namespace
  Path: lib_test
  MainIs: test_namespace.ml
  Build$: flag(tests)
  Custom: true
  CompiledObject: best
  Install: false
  BuildDepends: imap, oUnit (>= 2.0.0)

Test test_parser
  Run$: flag(tests)
  Command: $test_parser
  WorkingDirectory: lib_test

Test test_set
  Run$: flag(tests)
  Command: $test_set
  WorkingDirectory: lib_test

Test test_mutf7
  Run$: flag(tests)
  Command: $test_mutf7
  WorkingDirectory: lib_test

Test test_live
  Run$: flag(tests)
  Command: $test_live -runner sequential
  WorkingDirectory: lib_test

Test test_io
  Run$: flag(tests)
  Command: $test_io -runner sequential
  WorkingDirectory: lib_test

Test test_condstore
  Run$: flag(tests)
  Command: $test_condstore
  WorkingDirectory: lib_test

Test test_id
  Run$: flag(tests)
  Command: $test_id -runner sequential
  WorkingDirectory: lib_test

Test test_namespace
  Run$: flag(tests)
  Command: $test_namespace -runner sequential
  WorkingDirectory: lib_test
